<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quadro de Horários Interativo com Notas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        /* Estilos para o modal e animações */
        dialog::backdrop { background: rgba(0, 0, 0, 0.5); }
        .schedule-item:hover .delete-btn { opacity: 1; }
        .delete-btn { opacity: 0; transition: opacity 0.2s ease-in-out; }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 p-4 sm:p-6 md:p-8">

    <div class="max-w-7xl mx-auto">
        <!-- Cabeçalho -->
        <header class="mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-slate-900">Horário Académico Interativo</h1>
            <p class="text-slate-500 mt-1">Grelha unificada com controlo de notas persistente. Adicione, edite e remova itens.</p>
            <div class="flex flex-wrap gap-4 mt-4">
                <div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full bg-sky-200 border border-sky-300"></span><span class="text-sm font-medium">Arquitetura e Urbanismo</span></div>
                <div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full bg-teal-200 border border-teal-300"></span><span class="text-sm font-medium">Engenharia Civil</span></div>
                <div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full bg-amber-200 border border-amber-300"></span><span class="text-sm font-medium">Pessoal / Estudo</span></div>
            </div>
        </header>

        <!-- Grelha Principal de Horários -->
        <div class="bg-white p-4 rounded-2xl shadow-lg relative">
            <div id="schedule-grid" class="grid grid-cols-[auto_repeat(5,_1fr)] gap-1 sm:gap-2" style="grid-template-rows: auto repeat(16, minmax(50px, 1fr));">
                <!-- Conteúdo da grelha será gerado por JS -->
            </div>
            <button id="add-schedule-item-btn" class="absolute top-4 right-4 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition-colors shadow-md">
                + Adicionar ao Horário
            </button>
        </div>

        <!-- Secção de Controlo de Notas -->
        <section id="grade-tracker" class="mt-8">
            <div class="flex flex-wrap gap-4 justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-slate-900">Controlo de Notas</h2>
                <div class="flex gap-4">
                    <button id="reset-progress-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition-colors shadow-md">
                        Reiniciar Progresso
                    </button>
                    <button id="add-subject-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition-colors shadow-md">
                        + Adicionar Matéria
                    </button>
                </div>
            </div>
            <div id="grade-cards-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Cartões de notas serão injetados aqui pelo JavaScript -->
            </div>
        </section>
    </div>

    <!-- Modal para adicionar/editar Matérias e Itens de Horário -->
    <dialog id="item-modal" class="p-6 bg-white rounded-2xl shadow-xl w-full max-w-md">
        <h3 id="modal-title" class="text-2xl font-bold text-slate-900 mb-6">Adicionar Novo Item</h3>
        <form id="item-form">
            <input type="hidden" id="item-id">
            <div class="mb-4">
                <label for="item-name" class="block text-sm font-medium text-slate-700 mb-1">Nome da Matéria / Tarefa</label>
                <input type="text" id="item-name" class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-400" required>
            </div>
            <div class="mb-4">
                <label for="item-course" class="block text-sm font-medium text-slate-700 mb-1">Tipo / Curso</label>
                <select id="item-course" class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-400">
                    <option value="arq">Arquitetura e Urbanismo</option>
                    <option value="eng">Engenharia Civil</option>
                    <option value="personal">Pessoal / Estudo</option>
                </select>
            </div>
            
            <div id="schedule-fields" class="border-t pt-4 mt-4">
                 <p class="text-sm font-medium text-slate-600 mb-2">Detalhes do Horário (Opcional)</p>
                 <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="item-day" class="block text-sm font-medium text-slate-700 mb-1">Dia</label>
                        <select id="item-day" class="w-full p-2 border border-slate-300 rounded-lg">
                            <option value="1">Segunda-feira</option>
                            <option value="2">Terça-feira</option>
                            <option value="3">Quarta-feira</option>
                            <option value="4">Quinta-feira</option>
                            <option value="5">Sexta-feira</option>
                        </select>
                    </div>
                     <div>
                        <label for="item-start-time" class="block text-sm font-medium text-slate-700 mb-1">Horário Início</label>
                        <input type="time" id="item-start-time" step="1800" class="w-full p-2 border border-slate-300 rounded-lg">
                    </div>
                     <div>
                        <label for="item-end-time" class="block text-sm font-medium text-slate-700 mb-1">Horário Fim</label>
                        <input type="time" id="item-end-time" step="1800" class="w-full p-2 border border-slate-300 rounded-lg">
                    </div>
                </div>
            </div>

            <div class="mt-8 flex justify-end gap-4">
                <button type="button" id="modal-cancel-btn" class="bg-slate-200 text-slate-800 font-bold py-2 px-4 rounded-lg hover:bg-slate-300 transition-colors">Cancelar</button>
                <button type="submit" id="modal-save-btn" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors">Salvar</button>
            </div>
        </form>
    </dialog>


<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- GESTÃO DE ESTADO ---
    let appState = {
        subjects: [],
        schedule: []
    };
    
    const courseDetails = {
        arq: { name: 'Arquitetura', color: 'sky', textColor: 'text-sky-800', bgColor: 'bg-sky-200', borderColor: 'border-sky-300', progressColor: 'bg-sky-500' },
        eng: { name: 'Engenharia Civil', color: 'teal', textColor: 'text-teal-800', bgColor: 'bg-teal-200', borderColor: 'border-teal-300', progressColor: 'bg-teal-500' },
        personal: { name: 'Pessoal / Estudo', color: 'amber', textColor: 'text-amber-800', bgColor: 'bg-amber-200', borderColor: 'border-amber-300', progressColor: 'bg-amber-500' }
    };
    
    // Dados padrão completos
    const defaultSubjects = [
        { id: 'proj-vertical', name: 'Projeto de Edifício Vertical', course: 'arq', score: 85 },
        { id: 'proj-metalicas', name: 'Projeto em Estruturas Metálicas', course: 'arq', score: 65 },
        { id: 'plan-urbano', name: 'Planeamento Urbano e Regional', course: 'arq', score: 50 },
        { id: 'estagio', name: 'Estágio Obrigatório', course: 'arq', score: 100 },
        { id: 'teoria-arq', name: 'Teoria da Arquitetura', course: 'arq', score: 75 },
        { id: 'gestao-redes', name: 'Gestão de Redes e Mídias Sociais', course: 'arq', score: 90 },
        { id: 'mec-solos', name: 'Mecânica dos Solos Aplicada', course: 'eng', score: 70 },
        { id: 'mec-solidos', name: 'Mecânica dos Sólidos II', course: 'eng', score: 55 },
        { id: 'materiais-const', name: 'Materiais de Construção Civil I', course: 'eng', score: 80 },
        { id: 'calculo-3', name: 'Cálculo Aplicado III', course: 'eng', score: 95 },
        { id: 'geotecnia', name: 'Geotecnia', course: 'eng', score: 40 },
        { id: 'quimica', name: 'Química', course: 'eng', score: 88 },
        { id: 'estatistica', name: 'Estatística', course: 'eng', score: 60 },
        { id: 'negociacao', name: 'Negociação e Tomada de Decisão', course: 'eng', score: 98 },
    ];

    const defaultSchedule = [
        // Arquitetura
        { id: 'proj-vertical-sch', linkedId: 'proj-vertical', day: 2, start: 8, span: 5, time: '13:30-18:00' },
        { id: 'proj-metalicas-sch', linkedId: 'proj-metalicas', day: 3, start: 8, span: 4, time: '13:30-17:00' },
        { id: 'plan-urbano-sch', linkedId: 'plan-urbano', day: 1, start: 8, span: 4, time: '13:30-17:00' },
        { id: 'estagio-sch', linkedId: 'estagio', day: 3, start: 12, span: 2, time: '17:10-18:50' },
        { id: 'teoria-arq-sch', linkedId: 'teoria-arq', day: 4, start: 12, span: 2, time: '17:10-18:50' },
        { id: 'gestao-redes-sch', linkedId: 'gestao-redes', day: 5, start: 14, span: 2, time: '19:00-20:40' },
        // Engenharia
        { id: 'mec-solos-sch', linkedId: 'mec-solos', day: 5, start: 3, span: 4, time: '08:50-12:20' },
        { id: 'mec-solidos-sch', linkedId: 'mec-solidos', day: 3, start: 2, span: 3, time: '07:50-10:30' },
        { id: 'materiais-const-sch', linkedId: 'materiais-const', day: 1, start: 3, span: 4, time: '08:50-12:20' },
        { id: 'calculo-3-sch1', linkedId: 'calculo-3', day: 2, start: 3, span: 2, time: '08:50-10:30' },
        { id: 'calculo-3-sch2', linkedId: 'calculo-3', day: 4, start: 3, span: 2, time: '08:50-10:30' },
        { id: 'geotecnia-sch', linkedId: 'geotecnia', day: 1, start: 12, span: 2, time: '17:10-18:50' },
        { id: 'quimica-sch', linkedId: 'quimica', day: 3, start: 15, span: 2, time: '20:50-22:30' },
        { id: 'estatistica-sch', linkedId: 'estatistica', day: 5, start: 12, span: 2, time: '17:10-18:50' },
        { id: 'negociacao-sch', linkedId: 'negociacao', day: 2, start: 14, span: 2, time: '19:00-20:40' },
    ];


    // --- ELEMENTOS DO DOM ---
    const scheduleGrid = document.getElementById('schedule-grid');
    const gradeCardsContainer = document.getElementById('grade-cards-container');
    const itemModal = document.getElementById('item-modal');
    const itemForm = document.getElementById('item-form');
    const modalTitle = document.getElementById('modal-title');
    const scheduleFields = document.getElementById('schedule-fields');


    // --- PERSISTÊNCIA DE DADOS ---
    function saveState() {
        localStorage.setItem('academicAppState', JSON.stringify(appState));
    }

    function loadState() {
        const savedState = localStorage.getItem('academicAppState');
        if (savedState) {
            appState = JSON.parse(savedState);
        } else {
            appState.subjects = defaultSubjects;
            appState.schedule = defaultSchedule;
        }
    }


    // --- FUNÇÕES DE RENDERIZAÇÃO ---
    function renderSchedule() {
        scheduleGrid.innerHTML = ''; 
        const headerCells = ['Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta'];
        scheduleGrid.insertAdjacentHTML('beforeend', '<div></div>');
        headerCells.forEach(day => {
            scheduleGrid.insertAdjacentHTML('beforeend', `<div class="text-center font-bold text-slate-700 py-2 text-sm sm:text-base">${day}</div>`);
        });

        for (let i = 7; i <= 22; i++) {
            scheduleGrid.insertAdjacentHTML('beforeend', `<div class="text-right text-xs text-slate-400 pr-2 sm:pr-4 -mt-2" style="grid-row: ${i - 5};">${i}:00</div>`);
            for (let j = 1; j <= 5; j++) {
                scheduleGrid.insertAdjacentHTML('beforeend', `<div class="border-t border-slate-200" style="grid-column: ${j + 1}; grid-row: ${i - 5};"></div>`);
            }
        }

        appState.schedule.forEach(item => {
            const subjectId = item.linkedId || item.id;
            const subject = appState.subjects.find(s => s.id === subjectId);
            if (!subject) return;

            const details = courseDetails[subject.course];
            const itemDiv = document.createElement('div');
            itemDiv.className = `schedule-item p-2 rounded-lg border ${details.bgColor} ${details.borderColor} ${details.textColor} flex flex-col justify-between relative`;
            itemDiv.style.gridColumn = `${item.day + 1}`;
            itemDiv.style.gridRow = `${item.start} / span ${item.span}`;
            
            itemDiv.innerHTML = `
                <div>
                    <p class="font-semibold text-xs sm:text-sm">${subject.name}</p>
                    <p class="text-xs opacity-80 mt-1">${item.time}</p>
                </div>
                <button data-id="${item.id}" class="delete-btn absolute top-1 right-1 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold hover:bg-red-700">&times;</button>
            `;
            scheduleGrid.appendChild(itemDiv);
        });
    }

    function renderGradeCards() {
        gradeCardsContainer.innerHTML = '';
        if (appState.subjects.length === 0) {
            gradeCardsContainer.innerHTML = `<p class="text-slate-500 md:col-span-2 lg:col-span-3 text-center py-8">Nenhuma matéria adicionada. Clique em "Adicionar Matéria" para começar.</p>`;
            return;
        }
        
        appState.subjects.forEach(subject => {
            const details = courseDetails[subject.course];
            const card = document.createElement('div');
            card.className = "bg-white p-5 rounded-2xl shadow-lg flex flex-col";
            
            card.innerHTML = `
                <div class="flex-grow">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm font-medium text-slate-500">${details.name}</p>
                            <h3 class="font-bold text-lg text-slate-800">${subject.name}</h3>
                        </div>
                        <button data-id="${subject.id}" class="delete-subject-btn text-xl text-red-400 hover:text-red-600 font-bold transition-colors">&times;</button>
                    </div>
                    
                    <div class="mt-4">
                        <div class="flex justify-between mb-1">
                            <span class="text-sm font-medium ${details.textColor}">Progresso</span>
                            <span class="text-sm font-medium ${details.textColor}">${subject.score} / 100</span>
                        </div>
                        <div class="w-full bg-slate-200 rounded-full h-2.5">
                            <div class="h-2.5 rounded-full ${details.progressColor}" style="width: ${subject.score}%"></div>
                        </div>
                    </div>
                </div>

                <form class="mt-6 flex gap-2" data-id="${subject.id}">
                    <input type="number" placeholder="Pontos" min="0" class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-${details.color}-400 focus:border-${details.color}-400 transition">
                    <button type="submit" class="bg-${details.color}-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-${details.color}-600 transition-colors">
                        Adicionar
                    </button>
                </form>
            `;
            gradeCardsContainer.appendChild(card);
        });
    }
    
    function renderApp() {
        renderSchedule();
        renderGradeCards();
    }


    // --- HANDLERS DE EVENTOS & LÓGICA ---
    function openModal(type, data = {}) {
        itemForm.reset();
        const isEditing = !!data.id;
        document.getElementById('item-id').value = data.id || '';
        
        if (type === 'subject') {
            modalTitle.textContent = isEditing ? 'Editar Matéria' : 'Adicionar Matéria';
            scheduleFields.style.display = 'none';
            if(isEditing) {
                 const subject = appState.subjects.find(s => s.id === data.id);
                 document.getElementById('item-name').value = subject.name;
                 document.getElementById('item-course').value = subject.course;
            }
        } else {
            modalTitle.textContent = 'Adicionar ao Horário';
            scheduleFields.style.display = 'block';
        }

        itemModal.showModal();
    }
    
    function timeToRow(timeStr) {
        if (!timeStr) return 0;
        const [hours, minutes] = timeStr.split(':').map(Number);
        return (hours - 7) * 2 + (minutes / 30) + 2;
    }

    function resetAllScores() {
        if (confirm('Tem a certeza que deseja reiniciar o progresso de TODAS as matérias? Esta ação não pode ser desfeita.')) {
            appState.subjects.forEach(subject => {
                subject.score = 0;
            });
            saveState();
            renderApp();
        }
    }

    itemForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const id = document.getElementById('item-id').value || `subj-${Date.now()}`;
        const name = document.getElementById('item-name').value;
        const course = document.getElementById('item-course').value;
        const startTime = document.getElementById('item-start-time').value;
        const endTime = document.getElementById('item-end-time').value;

        const existingSubjectIndex = appState.subjects.findIndex(s => s.id === id);
        if (existingSubjectIndex > -1) {
            appState.subjects[existingSubjectIndex] = { ...appState.subjects[existingSubjectIndex], name, course };
        } else {
            appState.subjects.push({ id, name, course, score: 0 });
        }
        
        if (scheduleFields.style.display !== 'none' && startTime && endTime) {
            const startRow = timeToRow(startTime);
            const endRow = timeToRow(endTime);
            if (endRow > startRow) {
                appState.schedule.push({
                    id: `sch-${Date.now()}`,
                    linkedId: id,
                    day: parseInt(document.getElementById('item-day').value),
                    start: startRow,
                    span: endRow - startRow,
                    time: `${startTime}-${endTime}`
                });
            }
        }
        
        saveState();
        renderApp();
        itemModal.close();
    });

    gradeCardsContainer.addEventListener('submit', (e) => {
        e.preventDefault();
        if (e.target.tagName === 'FORM') {
            const subjectId = e.target.dataset.id;
            const input = e.target.querySelector('input[type="number"]');
            const points = parseFloat(input.value);

            if (!isNaN(points) && points > 0) {
                const subject = appState.subjects.find(s => s.id === subjectId);
                if (subject) {
                    subject.score = Math.min(100, subject.score + points);
                    saveState();
                    renderApp();
                }
            }
            input.value = '';
        }
    });

    document.body.addEventListener('click', (e) => {
        const target = e.target.closest('button');
        if (!target) return;

        if (target.matches('.delete-btn')) {
            const scheduleId = target.dataset.id;
            if (confirm('Tem a certeza que deseja remover este item do horário?')) {
                appState.schedule = appState.schedule.filter(item => item.id !== scheduleId);
                saveState();
                renderApp();
            }
        }
        if (target.matches('.delete-subject-btn')) {
            const subjectId = target.dataset.id;
             if (confirm('Tem a certeza que deseja remover esta matéria? Isto também removerá todos os seus horários agendados.')) {
                appState.subjects = appState.subjects.filter(s => s.id !== subjectId);
                appState.schedule = appState.schedule.filter(item => (item.linkedId) !== subjectId);
                saveState();
                renderApp();
            }
        }
    });

    document.getElementById('add-subject-btn').addEventListener('click', () => openModal('subject'));
    document.getElementById('add-schedule-item-btn').addEventListener('click', () => openModal('schedule'));
    document.getElementById('modal-cancel-btn').addEventListener('click', () => itemModal.close());
    document.getElementById('reset-progress-btn').addEventListener('click', resetAllScores);


    // --- INICIALIZAÇÃO ---
    loadState();
    renderApp();
});
</script>

</body>
</html>
